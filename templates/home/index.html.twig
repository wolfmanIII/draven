{% extends 'base.html.twig' %}

{% block title %}DRAVEN — Deployment Routing & Approval Verification ENgine{% endblock %}

{% block pageContent %}
<div class="bg-base-200 text-base-content">

    <div class="space-y-8 p-5">

        {# HERO #}
        <section class="grid gap-8 xl:gap-10 lg:grid-cols-[minmax(0,1.4fr),minmax(0,1fr)] items-start">
            <div class="space-y-6 text-center lg:text-left">
                <div class="badge badge-primary badge-lg font-semibold mx-auto lg:mx-0">
                    Deploy Control Plane
                </div>

                <h1 class="text-3xl sm:text-4xl lg:text-5xl font-bold leading-tight">
                    <span class="block text-info mt-2">
                        DRAVEN — Deployment Routing & Approval Verification ENgine
                    </span>
                </h1>

                <p class="text-base sm:text-lg opacity-80 max-w-2xl mx-auto lg:mx-0">
                    Deploy orchestrati su più progetti e ambienti (stage, demo, produzione), con approvazioni,
                    audit trail, lock per ambiente e integrazioni Bitbucket/GitHub/GitLab su runner Deployer.
                </p>

                <div class="flex flex-wrap justify-center lg:justify-start gap-3 sm:gap-4"></div>
            </div>

            <div class="w-full">
                <div class="card bg-base-100 shadow-xl border border-base-300">
                    <div class="card-body space-y-4">
                        <h2 class="card-title">
                            Flusso deploy DRAVEN
                        </h2>

                        <p class="text-base opacity-80">
                            L’utente seleziona progetto, ambiente e ref; DRAVEN valida la policy, prende il lock,
                            triggera la pipeline esterna e riceve gli esiti via webhook o polling.
                        </p>

                        <div class="mockup-code text-sm overflow-x-auto">
                            <pre data-prefix="$"><code>POST /deploy</code></pre>
                            <pre data-prefix=" "><code>{</code></pre>
                            <pre data-prefix=" "><code>  "project": "my-app",</code></pre>
                            <pre data-prefix=" "><code>  "environment": "production",</code></pre>
                            <pre data-prefix=" "><code>  "ref": "v1.2.3"</code></pre>
                            <pre data-prefix=" "><code>}</code></pre>
                        </div>

                        <p class="text-base opacity-70">
                            Output: job creato, policy rispettata, lock ambiente acquisito, pipeline
                            esterna triggerata con variabili standard (JOB_ID, ENV, REF, TYPE) e
                            callback per stato/log.
                        </p>

                    </div>
                </div>
            </div>
        </section>

        {# ROADMAP / STATO PROGETTO #}
        <section id="roadmap" class="space-y-4 lg:space-6 pb-4">
            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 sm:gap-4">
                <h2 class="text-xl sm:text-2xl font-bold">Stato del progetto &amp; Roadmap</h2>
                <span class="badge badge-warning badge-outline self-start sm:self-auto">
                    Work in progress
                </span>
            </div>

            <div class="grid gap-6 md:grid-cols-2">
                <div class="card bg-base-100 border border-base-300">
                    <div class="card-body space-y-3">
                        <h3 class="card-title text-base">Stato attuale</h3>
                        <ul class="list-disc list-inside text-sm opacity-80 space-y-1">
                            <li>Modello dati completo (Projects/Environments/Policies/Integrations/Jobs/Approvals/Lock/Log/ApiToken) con migrazione pronta.</li>
                            <li>Autenticazione form + Bearer token (ApiTokenAuthenticator) e layout base DRAVEN.</li>
                            <li>Homepage e login stilizzati, importmap allineato, loghi e icone aggiornati.</li>
                            <li>Deployer aggiunto in dev per uso nei runner, non ancora integrato nei flussi.</li>
                        </ul>
                    </div>
                </div>

                <div class="card bg-base-100 border border-base-300">
                    <div class="card-body space-y-3">
                        <h3 class="card-title text-base">Prossimi step</h3>
                        <ul class="list-disc list-inside text-sm opacity-80 space-y-1">
                            <li>CRUD/UI/API per Projects, Environments, Policies e Integrations (provider mapping).</li>
                            <li>Flusso creazione DeployJob con validazione policy, lock ambiente e approval gate.</li>
                            <li>Endpoint API per run e webhook provider firmato; adapter Bitbucket/GitHub/GitLab (stubs o primo provider).</li>
                            <li>UI Runs/Approvals con stato, ref, link esterno e azioni consentite da ruoli.</li>
                            <li>Seed policy baseline (stage/demo/prod) e comandi per utenti/token.</li>
                            <li>Test funzionali su API run/approval/webhook e blocco concorrente per ambiente.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

    </div>
</div>
{% endblock %}
